<h1><%= @recipe.title %></h1>

<% if @recipe.image.attached? %>
  <%= image_tag url_for(@recipe.image), width: 400 %>
<% end %>

<p><%= @recipe.body %></p>

<% if @recipe.tags.any? %>
  <div class="mt-2">
    <% @recipe.tags.each do |tag| %>
      <%= link_to "##{tag.name}",
            search_path(model: "recipe", keyword: tag.name),
            class: "badge bg-secondary me-1 text-decoration-none" %>
    <% end %>
  </div>
<% end %>

<p>投稿者：<%= link_to @recipe.user.name, user_path(@recipe.user) %></p>

<% if user_signed_in? && @recipe.user == current_user %>
  <%= link_to "編集", edit_recipe_path(@recipe) %> |
  <%= link_to "削除", recipe_path(@recipe),
        method: :delete,
        data: { confirm: "本当に削除しますか？" } %>
<% end %>

<%= link_to "一覧へ戻る", recipes_path %>

<hr>


<!-- 🔥 コメント一覧 -->

<h2>コメント一覧</h2>

<% @recipe.comments.each do |comment| %>
  <div style="margin-bottom: 10px;">
    <strong><%= comment.user.name %>：</strong>
    <%= comment.body %>

    <% if comment.user == current_user %>
      <%= link_to "削除", recipe_comment_path(@recipe, comment),
          method: :delete,
          data: { confirm: "本当に削除しますか？" } %>
    <% end %>
  </div>
<% end %>

<hr>


<!--  コメント投稿フォーム -->

<h3>コメントを投稿する</h3>

<% if user_signed_in? %>
  <%= form_with model: [@recipe, Comment.new], local: true do |f| %>
    <%= f.text_area :body, rows: 3 %><br>
    <%= f.submit "コメントする" %>
  <% end %>
<% else %>
  <p>コメントするには <%= link_to "ログイン", new_user_session_path %> してください。</p>
<% end %>